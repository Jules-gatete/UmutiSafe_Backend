import{r as n,j as e,A as I,a6 as O,a7 as X,a8 as B,a5 as G,a9 as J,aa as K}from"./vendor_react-CK1M0B1O-1761988251229.js";import{T as Q}from"./Table-p0UcKWoY-1761988251229.js";import{M as f}from"./Modal-D3WPayf--1761988251229.js";import{I as r}from"./Input-BvYti0rl-1761988251229.js";import{S as V}from"./Select-BAMn-yuu-1761988251229.js";import{b as u,a as Y}from"./index-BPH-ltX_-1761988251229.js";import"./vendor_misc-i1ZNofER-1761988251229.js";import"./vendor_axios-ngrFHoWO-1761988251229.js";function ne(){const[x,y]=n.useState("all"),[p,j]=n.useState("all"),[N,w]=n.useState([]),[C,A]=n.useState(!0),[o,i]=n.useState(null),[k,h]=n.useState(!1),[U,g]=n.useState(!1),[S,D]=n.useState(null),[m,b]=n.useState(!1),[t,v]=n.useState({name:"",email:"",password:"",phone:"",role:"user",sector:"",district:"",province:""});n.useEffect(()=>{c()},[]);const c=async()=>{try{const s=await u.getUsers();s.success&&w(s.data)}catch(s){console.error("Error fetching users:",s)}finally{A(!1)}},E=N.filter(s=>{const a=x==="all"||s.role===x,d=p==="all"||p==="pending"&&!s.isApproved||p==="approved"&&s.isApproved;return a&&d}),F=async s=>{if(confirm("Are you sure you want to approve this user?")){i(s);try{(await u.approveUser(s)).success&&(alert("User approved successfully! They will receive an email notification."),c())}catch(a){alert(a.response?.data?.message||"Failed to approve user")}finally{i(null)}}},M=async s=>{if(confirm("Are you sure you want to reject this user? This will deactivate their account.")){i(s);try{(await u.rejectUser(s)).success&&(alert("User rejected successfully"),c())}catch(a){alert(a.response?.data?.message||"Failed to reject user")}finally{i(null)}}},P=async s=>{if(confirm("Are you sure you want to activate this user account?")){i(s);try{(await u.activateUser(s)).success&&(alert("User account activated successfully! They can now login."),c())}catch(a){alert(a.response?.data?.message||"Failed to activate user")}finally{i(null)}}},R=async s=>{if(confirm("Are you sure you want to deactivate this user account? They will not be able to login.")){i(s);try{(await u.deactivateUser(s)).success&&(alert("User account deactivated successfully"),c())}catch(a){alert(a.response?.data?.message||"Failed to deactivate user")}finally{i(null)}}},T=[{key:"name",label:"Name",sortable:!0,render:(s,a)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-blue text-white flex items-center justify-center font-semibold text-sm",children:s.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.email})]})]})},{key:"role",label:"Role",sortable:!0,render:s=>e.jsx("span",{className:`badge badge-${s==="admin"?"danger":s==="chw"?"success":"info"}`,children:s.toUpperCase()})},{key:"isApproved",label:"Approval",sortable:!0,render:(s,a)=>e.jsx("span",{className:`badge ${s?"badge-success":"badge-warning"}`,children:s?"Approved":"Pending"})},{key:"isActive",label:"Account Status",sortable:!0,render:(s,a)=>e.jsx("span",{className:`badge ${s?"badge-success":"badge-danger"}`,children:s?"Active":"Inactive"})},{key:"phone",label:"Phone",sortable:!1},{key:"createdAt",label:"Member Since",sortable:!0,render:s=>new Date(s).toLocaleDateString()}],q=async s=>{if(confirm(`Are you sure you want to delete ${s.name}?`)){i(s.id);try{(await u.deleteUser(s.id)).success&&(alert("User deleted successfully"),c())}catch(a){console.error("Delete error:",a),alert(a.response?.data?.message||"Failed to delete user")}finally{i(null)}}},H=()=>{v({name:"",email:"",password:"",phone:"",role:"user",sector:"",district:"",province:""}),h(!0)},L=s=>{D(s),v({name:s.name||"",email:s.email||"",phone:s.phone||"",role:s.role||"user",sector:s.sector||"",district:s.district||"",province:s.province||"",password:""}),g(!0)},W=async s=>{s.preventDefault();const a=t.email.split("@")[1];if(t.role==="admin"&&a!=="umutisafe.gov.rw"){alert("Admin accounts must use @umutisafe.gov.rw email domain");return}if(t.role!=="admin"&&a==="umutisafe.gov.rw"){alert("Regular users and CHWs cannot use @umutisafe.gov.rw email domain");return}try{b(!0),(await Y.register(t)).success&&(alert("User created successfully!"),h(!1),c())}catch(d){console.error("Error creating user:",d),alert(d.response?.data?.message||"Failed to create user")}finally{b(!1)}},$=async s=>{s.preventDefault();try{b(!0);const a={name:t.name,phone:t.phone,sector:t.sector,district:t.district,province:t.province};(await u.updateUser(S.id,a)).success&&(alert("User updated successfully!"),g(!1),c())}catch(a){console.error("Error updating user:",a),alert(a.response?.data?.message||"Failed to update user")}finally{b(!1)}},l=s=>{const{name:a,value:d}=s.target;v(z=>({...z,[a]:d}))};return C?e.jsx("div",{className:"p-4 lg:p-8 flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-blue"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading users..."})]})}):e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"Manage Users"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage all users and CHWs in the system"})]}),e.jsxs("button",{onClick:H,className:"btn-primary flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"Add User"]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsxs("select",{value:x,onChange:s=>y(s.target.value),className:"input-field flex-1 max-w-xs",children:[e.jsx("option",{value:"all",children:"All Roles"}),e.jsx("option",{value:"user",children:"Household Users"}),e.jsx("option",{value:"chw",children:"CHWs"}),e.jsx("option",{value:"admin",children:"Admins"})]}),e.jsxs("select",{value:p,onChange:s=>j(s.target.value),className:"input-field flex-1 max-w-xs",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"pending",children:"Pending Approval"})]})]})}),e.jsx("div",{className:"card",children:e.jsx(Q,{columns:T,data:E,actions:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[!s.isApproved&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>F(s.id),className:"btn-outline py-2 px-3 text-sm text-green-600 border-green-600 hover:bg-green-50 dark:hover:bg-green-900 dark:hover:bg-opacity-20",title:"Approve user",disabled:o===s.id,children:o===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}):e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(s.id),className:"btn-outline py-2 px-3 text-sm text-red-600 border-red-600 hover:bg-red-50 dark:hover:bg-red-900 dark:hover:bg-opacity-20",title:"Reject user",disabled:o===s.id,children:o===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-600"}):e.jsx(X,{className:"w-4 h-4"})})]}),s.isActive?e.jsx("button",{onClick:()=>R(s.id),className:"btn-outline py-2 px-3 text-sm text-orange-600 border-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900 dark:hover:bg-opacity-20",title:"Deactivate account",disabled:o===s.id,children:o===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-orange-600"}):e.jsx(B,{className:"w-4 h-4"})}):e.jsx("button",{onClick:()=>P(s.id),className:"btn-outline py-2 px-3 text-sm text-green-600 border-green-600 hover:bg-green-50 dark:hover:bg-green-900 dark:hover:bg-opacity-20",title:"Activate account",disabled:o===s.id,children:o===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-600"}):e.jsx(G,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(s),className:"btn-outline py-2 px-3 text-sm",title:"Edit user",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>q(s),className:"btn-outline py-2 px-3 text-sm text-warning border-warning hover:bg-red-50 dark:hover:bg-red-900 dark:hover:bg-opacity-20",title:"Delete user",disabled:o===s.id,children:e.jsx(K,{className:"w-4 h-4"})})]})})}),e.jsx(f,{isOpen:k,onClose:()=>h(!1),title:"Add New User",size:"lg",children:e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Full Name *",id:"name",name:"name",value:t.name,onChange:l,required:!0}),e.jsx(r,{label:"Email *",id:"email",name:"email",type:"email",value:t.email,onChange:l,required:!0}),e.jsx(r,{label:"Password *",id:"password",name:"password",type:"password",value:t.password,onChange:l,required:!0}),e.jsx(r,{label:"Phone",id:"phone",name:"phone",type:"tel",value:t.phone,onChange:l}),e.jsx(V,{label:"Role *",id:"role",name:"role",value:t.role,onChange:l,options:[{value:"user",label:"Household User"},{value:"chw",label:"Community Health Worker"},{value:"admin",label:"Administrator"}],required:!0}),e.jsx(r,{label:"Sector",id:"sector",name:"sector",value:t.sector,onChange:l}),e.jsx(r,{label:"District",id:"district",name:"district",value:t.district,onChange:l}),e.jsx(r,{label:"Province",id:"province",name:"province",value:t.province,onChange:l})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>h(!1),className:"btn-outline flex-1",disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:m,children:m?"Creating...":"Create User"})]})]})}),e.jsx(f,{isOpen:U,onClose:()=>g(!1),title:"Edit User",size:"lg",children:e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Full Name *",id:"name",name:"name",value:t.name,onChange:l,required:!0}),e.jsx(r,{label:"Email",id:"email",name:"email",type:"email",value:t.email,disabled:!0,className:"bg-gray-100 dark:bg-gray-800"}),e.jsx(r,{label:"Phone",id:"phone",name:"phone",type:"tel",value:t.phone,onChange:l}),e.jsx(r,{label:"Role",id:"role",name:"role",value:t.role,disabled:!0,className:"bg-gray-100 dark:bg-gray-800"}),e.jsx(r,{label:"Sector",id:"sector",name:"sector",value:t.sector,onChange:l}),e.jsx(r,{label:"District",id:"district",name:"district",value:t.district,onChange:l}),e.jsx(r,{label:"Province",id:"province",name:"province",value:t.province,onChange:l})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-outline flex-1",disabled:m,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:m,children:m?"Updating...":"Update User"})]})]})})]})}export{ne as default};
