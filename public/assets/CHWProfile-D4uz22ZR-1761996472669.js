import{r as t,j as e,t as M,x as W,y as D,a0 as F,a3 as O}from"./vendor_react-9x5ZZJiw-1761996472669.js";import{I as d}from"./Input-TsrCJ98U-1761996472669.js";import{a as k,c as x}from"./index-CNNDCTkG-1761996472669.js";import"./vendor_misc-i1ZNofER-1761996472669.js";import"./vendor_axios-ngrFHoWO-1761996472669.js";function q(){const[o,p]=t.useState(!1),[C,w]=t.useState("available"),[s,g]=t.useState({name:"",email:"",phone:"",sector:""}),[P,h]=t.useState(!0),[u,f]=t.useState(!1),[J,j]=t.useState(""),[m,A]=t.useState({totalPickups:0,completed:0,pending:0}),[y,v]=t.useState(""),[b,N]=t.useState(""),[L,E]=t.useState([]);JSON.parse(localStorage.getItem("user")||"{}"),t.useEffect(()=>{S();const a=()=>S();return window.addEventListener("focus",a),()=>window.removeEventListener("focus",a)},[]);const S=async()=>{try{h(!0);const[a,l,n]=await Promise.all([k.getMe(),x.getDashboard(),x.getPickups()]);if(a?.success){const i=a.data;localStorage.setItem("user",JSON.stringify(i)),g({name:i.name||"",email:i.email||"",phone:i.phone||"",sector:i.sector||""})}l?.success&&A({totalPickups:l.data.total||0,completed:l.data.completed||0,pending:l.data.pending||0}),n?.success&&E(n.data||[]),j("")}catch(a){console.error("Error loading CHW profile data",a),j("Failed to load CHW data")}finally{h(!1)}},c=a=>{const{name:l,value:n}=a.target;g({...s,[l]:n})},I=async()=>{try{f(!0);const a=await k.updateProfile(s);if(a?.success){const l={...JSON.parse(localStorage.getItem("user")||"{}"),...s};localStorage.setItem("user",JSON.stringify(l)),p(!1),v("Profile updated successfully"),setTimeout(()=>v(""),4e3)}else alert(a?.message||"Failed to update profile")}catch(a){console.error("Error saving profile",a),alert("Failed to update profile")}finally{f(!1)}},H=async a=>{w(a);try{await x.updateAvailability(a),N("Availability updated"),setTimeout(()=>N(""),3e3)}catch(l){console.error("Failed to update availability",l)}};if(P)return e.jsx("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8 max-w-4xl mx-auto",children:e.jsx("div",{className:"text-center py-12",children:"Loading CHW profile..."})});const r=JSON.parse(localStorage.getItem("user")||"{}");return e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"CHW Profile"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Manage your profile and availability"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary-green text-white flex items-center justify-center font-bold text-3xl mx-auto mb-4",children:r.avatar||(r.name?r.name.split(" ").map(a=>a[0]).join("").toUpperCase():"CHW")}),e.jsx("h2",{className:"text-xl font-bold mb-1",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:"Community Health Worker"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Availability Status"}),e.jsxs("select",{value:C,onChange:a=>H(a.target.value),className:"input-field",children:[e.jsx("option",{value:"available",children:"Available"}),e.jsx("option",{value:"busy",children:"Busy"}),e.jsx("option",{value:"off_duty",children:"Off Duty"})]})]}),e.jsx("button",{onClick:()=>p(!o),className:"btn-outline w-full",children:o?"Cancel":"Edit Profile"})]}),b&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 border-l-4 border-green-400 text-green-800 rounded",children:b}),e.jsxs("div",{className:"lg:col-span-2 card",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Contact Information"}),o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{label:"Full Name",id:"name",name:"name",value:s.name,onChange:c}),e.jsx(d,{label:"Email",id:"email",name:"email",type:"email",value:s.email,onChange:c}),e.jsx(d,{label:"Phone",id:"phone",name:"phone",type:"tel",value:s.phone,onChange:c}),e.jsx(d,{label:"Coverage Sector",id:"sector",name:"sector",value:s.sector,onChange:c}),e.jsx("button",{onClick:I,className:"btn-primary w-full",disabled:u,children:u?"Saving...":"Save Changes"})]}),y&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 border-l-4 border-green-400 text-green-800 rounded",children:y})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(M,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Email"}),e.jsx("p",{className:"font-medium",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Phone"}),e.jsx("p",{className:"font-medium",children:s.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Coverage Area"}),e.jsx("p",{className:"font-medium",children:s.sector||r.coverageArea||"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"CHW Since"}),e.jsx("p",{className:"font-medium",children:r.createdAt?new Date(r.createdAt).toLocaleDateString():"N/A"})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Performance Statistics"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-primary-blue dark:text-accent-cta mb-1",children:m.totalPickups}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Pickups"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-primary-green mb-1",children:m.completed}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-yellow-500 mb-1",children:m.pending}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"})]})]})]})]})}export{q as default};
