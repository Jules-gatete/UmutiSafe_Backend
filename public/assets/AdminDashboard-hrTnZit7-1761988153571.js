import{r as m,j as e,i as F,Y as H,L as k,l as $,a4 as B,I as Y,a5 as W}from"./vendor_react-Dd6aiuOH-1761988153571.js";import{S as h}from"./StatCard-CZTiY7cL-1761988153571.js";import{b as M}from"./index-BNm4ZFjM-1761988153571.js";import{R as L,B as G,C as K,X as O,Y as X,T as A,L as z,a as q,P as J,b as Q,c as V}from"./vendor_recharts-DDmItuZW-1761988153571.js";import"./vendor_misc-i1ZNofER-1761988153571.js";import"./vendor_axios-ngrFHoWO-1761988153571.js";function ie(){const[n,D]=m.useState(null),[c,T]=m.useState([]),[C,y]=m.useState(!0),U=s=>{if(!s)return null;const a=s.data||s,t=a.stats||a.data||a,r=t.total_users??t.totalUsers??t.users_count??0,l=t.total_chws??t.totalChws??t.chw_count??0,i=t.total_disposals??t.totalDisposals??t.disposals_count??0,o=t.completed_this_month??t.completedThisMonth??t.completed??0,d=t.previous_month??t.previousMonth??0,g=t.risk_distribution||t.riskDistribution||t.risk||{},w={};Object.keys(g).forEach(f=>{f!=null&&(w[String(f).toUpperCase()]=g[f]??0)});const I=Array.isArray(t.monthly_trend)?t.monthly_trend:Array.isArray(t.monthlyTrend)?t.monthlyTrend:[],P=Array.isArray(t.top_medicines)?t.top_medicines:Array.isArray(t.topMedicines)?t.topMedicines:[];return{...t,total_users:r,total_chws:l,total_disposals:i,completed_this_month:o,previous_month:d,risk_distribution:w,monthly_trend:I,top_medicines:P}};m.useEffect(()=>{b()},[]);async function b(){try{y(!0);const[s,a]=await Promise.all([M.getStats(),M.getPendingUsers()]);s&&s.success&&D(U(s.data)),a&&a.success&&T(a.data)}catch(s){console.error("Error fetching dashboard data:",s)}finally{y(!1)}}if(C)return e.jsx("div",{className:"p-4 lg:p-8 flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-blue"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading dashboard..."})]})});if(!n)return e.jsx("div",{className:"p-4 lg:p-8 flex items-center justify-center h-64",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Failed to load dashboard data"})});const x=n&&n.risk_distribution||{LOW:0,MEDIUM:0,HIGH:0},j=[{name:"Low Risk",value:x.LOW||0,color:"#2E8B57"},{name:"Medium Risk",value:x.MEDIUM||0,color:"#F59E0B"},{name:"High Risk",value:x.HIGH||0,color:"#E03E2D"}],u=(s=>{const a=[],t=new Date;for(let r=s-1;r>=0;r--){const l=new Date(t.getFullYear(),t.getMonth()-r,1),i=l.toLocaleString("default",{month:"short"});a.push({label:i,year:l.getFullYear(),monthIndex:l.getMonth()})}return a})(3),E=n&&Array.isArray(n.monthly_trend)?n.monthly_trend:[],N=u.map(s=>{const a=E.find(r=>{if(!r)return!1;const l=r.month??r.label??r.month_label??r.month_label_short??r;if(typeof l=="string"&&/^\d{4}-\d{2}$/.test(l)){const[o,d]=l.split("-");return new Date(Number(o),Number(d)-1,1).toLocaleString("default",{month:"short"})===s.label}if(typeof l=="string"){try{const o=new Date(l);if(!isNaN(o)&&o.toLocaleString("default",{month:"short"})===s.label)return!0}catch{}if(l===s.label||l.startsWith(s.label))return!0}const i=r.monthIndex??r.month_index??r.m;return typeof i=="number"?i===s.monthIndex+1||i===s.monthIndex:!1}),t=a?a.count??a.value??a.total??0:0;return{month:s.label,count:t}}),p=n&&Array.isArray(n.top_medicines)?n.top_medicines:n&&Array.isArray(n.topMedicines)?n.topMedicines:[],R=u[u.length-1].label,v=N.find(s=>s.month===R),_=(n&&(n.completed_this_month??n.completed??null))??(v?v.count:0),S=(()=>{const s=_||0,a=n.previous_month||0;if(!a)return"";const t=(s-a)/Math.max(1,a)*100;return`${t>=0?"+":""}${t.toFixed(0)}% this month`})();return e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"Dashboard"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Monitor community system-wide medicine disposal activities"}),e.jsx("button",{onClick:b,className:"btn-outline ml-auto",children:"Refresh"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(h,{icon:F,label:"Total Users",value:n.total_users||0,color:"blue"}),e.jsx(h,{icon:H,label:"Community Health Workers",value:n.total_chws||0,color:"green"}),e.jsx(k,{to:"/admin/disposals",className:"block",children:e.jsx(h,{icon:$,label:"Total Disposals",value:n.total_disposals||0,color:"blue"})}),e.jsx(h,{icon:B,label:"This Month",value:_||0,color:"green",trend:S})]}),c.length>0&&e.jsxs("div",{className:"card mb-8 border-l-4 border-warning",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-warning/10 rounded-lg",children:e.jsx(Y,{className:"w-6 h-6 text-warning"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Pending User Approvals"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[c.length," user",c.length!==1?"s":""," waiting for approval"]})]})]}),e.jsxs(k,{to:"/admin/users",className:"btn-primary text-sm",children:[e.jsx(W,{className:"w-4 h-4"}),"Manage Users"]})]}),e.jsxs("div",{className:"space-y-2",children:[c.slice(0,3).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.email})]}),e.jsx("span",{className:"px-3 py-1 bg-warning/20 text-warning rounded-full text-xs font-medium",children:s.role.toUpperCase()})]},s.id)),c.length>3&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center pt-2",children:["+",c.length-3," more pending approval"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Monthly Disposal Trend"}),e.jsx(L,{width:"100%",height:300,children:e.jsxs(G,{data:N,children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"month"}),e.jsx(X,{}),e.jsx(A,{}),e.jsx(z,{}),e.jsx(q,{dataKey:"count",fill:"#0B6FA7",name:"Disposals"})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Risk Level Distribution"}),e.jsx(L,{width:"100%",height:300,children:e.jsxs(J,{children:[e.jsx(Q,{data:j,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:j.map((s,a)=>e.jsx(V,{fill:s.color},`cell-${a}`))}),e.jsx(A,{})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"Top Disposed Medicines"}),e.jsx("div",{className:"space-y-3",children:p.length===0?e.jsx("div",{className:"p-4 text-gray-600",children:"No data available"}):p.map((s,a)=>{const t=p[0]?.count||1,r=s.count/t*100;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary-blue text-white flex items-center justify-center font-bold text-sm",children:a+1}),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-48 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-green h-2 rounded-full",style:{width:`${r}%`}})}),e.jsx("span",{className:"text-sm font-semibold text-gray-600 dark:text-gray-400 w-16 text-right",children:s.count})]})]},a)})})]})]})}export{ie as default};
