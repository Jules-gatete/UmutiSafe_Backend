import{r,j as e,D as G,K as H,a2 as q,ab as B,a9 as $,aa as O}from"./vendor_react-9x5ZZJiw-1761996472669.js";import{T as Q}from"./Table-CzZgM5OE-1761996472669.js";import{M as z}from"./Modal-B7UfJj_u-1761996472669.js";import{I as n}from"./Input-TsrCJ98U-1761996472669.js";import{S as K}from"./Select-BOY8HrtR-1761996472669.js";import{T as W}from"./Textarea-6EGELL80-1761996472669.js";import{m}from"./index-CNNDCTkG-1761996472669.js";import"./vendor_misc-i1ZNofER-1761996472669.js";import"./vendor_axios-ngrFHoWO-1761996472669.js";function le(){const[u,k]=r.useState(""),[i,b]=r.useState(null),[p,C]=r.useState([]),[w,x]=r.useState(!0),[f,M]=r.useState(""),[J,y]=r.useState(!1),[S,c]=r.useState(!1),[d,v]=r.useState(null),[g,N]=r.useState(!1),[t,h]=r.useState({genericName:"",brandName:"",dosageForm:"",strength:"",category:"",riskLevel:"MEDIUM",manufacturer:"",fdaApproved:!0,disposalInstructions:""});r.useEffect(()=>{o();const a=()=>{document.hidden||o()};return document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a)}},[]);const o=async()=>{try{x(!0);const a=await m.getAll();a.success&&C(a.data)}catch(a){console.error("Error fetching medicines:",a),M("Failed to load medicines registry")}finally{x(!1)}},j=r.useMemo(()=>{if(!u)return p;const a=u.toLowerCase();return p.filter(s=>(s.genericName||"").toLowerCase().includes(a)||(s.brandName||"").toLowerCase().includes(a)||(s.manufacturer||"").toLowerCase().includes(a))},[p,u]),F=[{key:"genericName",label:"Generic Name",sortable:!0},{key:"brandName",label:"Brand Name",sortable:!0},{key:"dosageForm",label:"Form",sortable:!0},{key:"strength",label:"Strength",sortable:!1},{key:"category",label:"Category",sortable:!0},{key:"riskLevel",label:"Risk",sortable:!0,render:a=>e.jsx("span",{className:`badge badge-${a==="HIGH"?"danger":a==="MEDIUM"?"warning":"success"}`,children:a})}],A=a=>{b(a.target.files[0])},D=async()=>{if(!i){alert("Please select a CSV file first");return}try{y(!0);const a=new FormData;a.append("file",i),(await m.uploadCSV(a)).success&&(alert("CSV uploaded successfully!"),b(null),o())}catch(a){console.error("Error uploading CSV:",a),alert("Failed to upload CSV. Please try again.")}finally{y(!1)}},E=()=>{v(null),h({genericName:"",brandName:"",dosageForm:"",strength:"",category:"",riskLevel:"MEDIUM",manufacturer:"",fdaApproved:!0,disposalInstructions:""}),c(!0)},L=a=>{v(a),h({genericName:a.genericName||"",brandName:a.brandName||"",dosageForm:a.dosageForm||"",strength:a.strength||"",category:a.category||"",riskLevel:a.riskLevel||"MEDIUM",manufacturer:a.manufacturer||"",fdaApproved:a.fdaApproved!==void 0?a.fdaApproved:!0,disposalInstructions:a.disposalInstructions||""}),c(!0)},I=async a=>{if(confirm(`Are you sure you want to delete ${a.genericName}?`))try{(await m.delete(a.id)).success&&(alert("Medicine deleted successfully!"),o())}catch(s){console.error("Error deleting medicine:",s),alert("Failed to delete medicine. Please try again.")}},R=async a=>{if(a.preventDefault(),!t.genericName){alert("Please enter the generic name");return}try{N(!0);let s;d?s=await m.update(d.id,t):s=await m.create(t),s.success&&(alert(`Medicine ${d?"updated":"created"} successfully!`),c(!1),o())}catch(s){console.error("Error saving medicine:",s),alert("Failed to save medicine. Please try again.")}finally{N(!1)}},l=a=>{const{name:s,value:U,type:P,checked:V}=a.target;h(T=>({...T,[s]:P==="checkbox"?V:U}))};return w?e.jsx("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-blue mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading medicines registry..."})]})})}):e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"Medicines Registry"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Manage Rwanda FDA approved medicines database"}),f&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg",children:f}),e.jsx("div",{className:"card mb-6 bg-primary-blue text-white",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(G,{className:"w-12 h-12 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Upload FDA Registry CSV"}),e.jsx("p",{className:"text-white text-opacity-90 mb-4",children:"Update the medicines database by uploading a CSV file from Rwanda FDA. The file should include: Generic Name, Brand Name, Dosage Form, Strength, Category, Risk Level."}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("label",{className:"btn-secondary cursor-pointer inline-flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("input",{type:"file",accept:".csv",onChange:A,className:"hidden"}),i?i.name:"Choose CSV File"]}),i&&e.jsx("button",{onClick:D,className:"btn-outline border-white text-white hover:bg-white hover:text-primary-blue",children:"Upload & Process"})]})]})]})}),e.jsx("div",{className:"card mb-6",children:e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx("input",{type:"search",value:u,onChange:a=>k(a.target.value),placeholder:"Search medicines...",className:"input-field pl-10"})]})})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Medicine Database (",j.length," entries)"]}),e.jsxs("button",{onClick:E,className:"btn-primary",children:[e.jsx(B,{className:"w-4 h-4"}),"Add Medicine"]})]}),e.jsx(Q,{columns:F,data:j,actions:a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(a),className:"btn-outline py-2 px-3 text-sm",title:"Edit medicine",children:e.jsx($,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>I(a),className:"btn-outline py-2 px-3 text-sm text-red-600 border-red-600 hover:bg-red-50 dark:hover:bg-red-900 dark:hover:bg-opacity-20",title:"Delete medicine",children:e.jsx(O,{className:"w-4 h-4"})})]})})]}),e.jsx(z,{isOpen:S,onClose:()=>c(!1),title:d?"Edit Medicine":"Add New Medicine",size:"lg",children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Generic Name *",id:"genericName",name:"genericName",value:t.genericName,onChange:l,required:!0}),e.jsx(n,{label:"Brand Name",id:"brandName",name:"brandName",value:t.brandName,onChange:l}),e.jsx(n,{label:"Dosage Form",id:"dosageForm",name:"dosageForm",value:t.dosageForm,onChange:l,placeholder:"e.g., Tablet, Capsule, Syrup"}),e.jsx(n,{label:"Strength",id:"strength",name:"strength",value:t.strength,onChange:l,placeholder:"e.g., 500mg, 10ml"}),e.jsx(n,{label:"Category",id:"category",name:"category",value:t.category,onChange:l,placeholder:"e.g., Antibiotic, Painkiller"}),e.jsx(K,{label:"Risk Level *",id:"riskLevel",name:"riskLevel",value:t.riskLevel,onChange:l,options:[{value:"LOW",label:"Low Risk"},{value:"MEDIUM",label:"Medium Risk"},{value:"HIGH",label:"High Risk"}],required:!0}),e.jsx(n,{label:"Manufacturer",id:"manufacturer",name:"manufacturer",value:t.manufacturer,onChange:l}),e.jsxs("div",{className:"flex items-center gap-2 pt-6",children:[e.jsx("input",{type:"checkbox",id:"fdaApproved",name:"fdaApproved",checked:t.fdaApproved,onChange:l,className:"w-4 h-4 text-primary-blue border-gray-300 rounded focus:ring-primary-blue"}),e.jsx("label",{htmlFor:"fdaApproved",className:"text-sm font-medium",children:"FDA Approved"})]})]}),e.jsx(W,{label:"Disposal Instructions",id:"disposalInstructions",name:"disposalInstructions",value:t.disposalInstructions,onChange:l,rows:3,placeholder:"Enter disposal instructions..."}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),className:"btn-outline flex-1",disabled:g,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary flex-1",disabled:g,children:g?"Saving...":d?"Update Medicine":"Add Medicine"})]})]})})]})}export{le as default};
