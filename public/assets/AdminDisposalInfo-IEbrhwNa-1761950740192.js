import{ac as q,a as l,j as e,L as D}from"./vendor_react-DOB-gmpH-1761950740192.js";import{d as o,b as u,f as y}from"./index-D4UIu5-w-1761950740192.js";import"./vendor_misc-B6hkzPCy-1761950740192.js";import"./vendor_axios-ngrFHoWO-1761950740192.js";function C(){const{id:n}=q(),[s,r]=l.useState(null),[N,g]=l.useState(!0),[h,x]=l.useState(""),[j,k]=l.useState(!1);l.useEffect(()=>{(async()=>{try{let c;try{c=await o.getById(n);const t=c.data??c;r(t);return}catch(t){if(t?.response?.status===404)try{const a=await u.getDisposalById(n),m=a&&a.data?a.data:a?.data??a;r(m);return}catch(a){throw console.error("Admin disposal fetch failed",a),a}throw t}}catch(c){console.error("Error loading disposal",c);const t=c?.response?.status;x(t===404?"Disposal not found (404)":"Failed to load disposal")}finally{g(!1)}})()},[n]);const b=async d=>{try{try{await o.update(n,{status:d})}catch{await y.put(`/admin/disposals/${n}`,{status:d})}try{const c=await o.getById(n),t=c?.data??c;if(t)r(t);else{const a=await u.getDisposalById(n),m=a&&a.data?a.data:a?.data??a;r(m)}}catch{const t=await u.getDisposalById(n),a=t&&t.data?t.data:t?.data??t;r(a)}}catch(c){console.error(c),alert("Failed to update status")}},w=async()=>{if(confirm("Delete this disposal?"))try{try{await o.delete(n)}catch{await y.delete(`/admin/disposals/${n}`)}window.location.href="/admin/disposals"}catch(d){console.error(d),alert("Failed to delete")}};if(N)return e.jsx("div",{className:"p-8 text-center",children:"Loading..."});if(h)return e.jsx("div",{className:"p-8 text-center text-red-600",children:h});if(!s)return e.jsx("div",{className:"p-8 text-center",children:"No disposal found"});const i=d=>d==null||d===""?"--":d,v=i(s.genericName||s.generic_name||s.medicine_name),p=i(s.brandName||s.brand_name||""),R=i(s.riskLevel||s.risk_level||"N/A"),f=i(s.createdAt||s.created_at||s.createdAt);return e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Disposal #",i(s.id)]}),e.jsx(D,{to:"/admin/disposals",className:"text-sm text-primary-blue",children:"Back"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("button",{className:"btn-outline text-sm",onClick:()=>k(d=>!d),children:j?"Hide raw":"Show raw payload"}),j&&e.jsx("pre",{className:"mt-2 p-3 bg-gray-50 rounded max-h-60 overflow-auto text-xs",children:JSON.stringify(s,null,2)})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Medicine"}),e.jsxs("p",{children:[v," ",p&&p!=="--"?`(${p})`:""]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Risk Level"}),e.jsx("p",{children:R})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Status"}),e.jsx("p",{children:i(s.status)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Submitted"}),e.jsx("p",{children:f==="--"?"--":new Date(f).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Disposed By"}),e.jsx("p",{children:i(s.user?.name||s.disposedBy)}),e.jsx("p",{className:"text-sm text-gray-600",children:i(s.user?.email||"")})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Pickup"}),s.pickupRequest?e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Requested By: ",i(s.pickupRequest.requester?.name||s.requested_by||s.requester_name)]}),e.jsxs("p",{children:["CHW: ",i(s.pickupRequest.chw?.name||"Not assigned")]}),e.jsxs("p",{children:["Status: ",i(s.pickupRequest.status)]}),e.jsxs("p",{children:["Picked Up By: ",i(s.pickupRequest.chw?.name||s.picked_by||s.pickedBy)]}),e.jsxs("p",{children:["Location: ",i(s.pickupRequest.pickupLocation||s.pickup_location)]})]}):e.jsx("p",{children:"No pickup requested"})]})]})}),e.jsxs("div",{className:"card mb-6",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Classification & Guidance"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Predicted Category:"})," ",s.predictedCategory||s.predicted_category||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Confidence:"})," ",s.confidence?(s.confidence*100).toFixed(1)+"%":"N/A"]}),e.jsxs("div",{className:"mt-3 bg-blue-50 dark:bg-blue-900 dark:bg-opacity-20 rounded-lg p-3 border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-semibold mb-1",children:"Disposal Guidance"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:s.disposalGuidance||s.disposal_guidance||"No guidance available"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>b("completed"),className:"btn-primary",children:"Mark Completed"}),e.jsx("button",{onClick:()=>b("pickup_requested"),className:"btn-outline",children:"Mark Pickup Requested"}),e.jsx("button",{onClick:w,className:"btn-danger",children:"Delete"})]})]})}export{C as default};
