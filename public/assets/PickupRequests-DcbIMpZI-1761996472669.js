import{r as l,j as e,X as P,y as j}from"./vendor_react-9x5ZZJiw-1761996472669.js";import{T as A}from"./Table-CzZgM5OE-1761996472669.js";import{M as E}from"./Modal-B7UfJj_u-1761996472669.js";import{S as T}from"./Select-BOY8HrtR-1761996472669.js";import{T as M}from"./Textarea-6EGELL80-1761996472669.js";import{S as I}from"./SearchBar-DRMifHhP-1761996472669.js";import{c as D,p as F}from"./index-CNNDCTkG-1761996472669.js";import"./vendor_misc-i1ZNofER-1761996472669.js";import"./vendor_axios-ngrFHoWO-1761996472669.js";function X(){const[m,N]=l.useState([]),[v,p]=l.useState(!0),[x,y]=l.useState(""),[a,n]=l.useState(null),[d,h]=l.useState(""),[g,b]=l.useState(""),[c,k]=l.useState("all"),[o,w]=l.useState(""),[u,f]=l.useState(!1);l.useEffect(()=>{i();const s=setInterval(()=>{i()},1e4),t=()=>{document.hidden||i()},r=()=>{i()};return document.addEventListener("visibilitychange",t),window.addEventListener("focus",r),()=>{clearInterval(s),document.removeEventListener("visibilitychange",t),window.removeEventListener("focus",r)}},[]);const i=async()=>{try{p(!0);const s=await D.getPickups();s.success&&N(s.data)}catch(s){console.error("Error fetching pickups:",s),y("Failed to load pickup requests")}finally{p(!1)}},S=l.useMemo(()=>{let s=m;if(c!=="all"&&(s=s.filter(t=>t.status===c)),o){const t=o.toLowerCase();s=s.filter(r=>(r.requester?.name||"").toLowerCase().includes(t)||(r.medicineName||"").toLowerCase().includes(t)||(r.pickupLocation||"").toLowerCase().includes(t))}return s},[m,c,o]),q=[{value:"scheduled",label:"Schedule Pickup"},{value:"collected",label:"Mark as Collected"},{value:"requires_inspection",label:"Requires Inspection"},{value:"rejected",label:"Reject Request"}],R=[{key:"requester",label:"Requester",sortable:!0,render:s=>s?.name||"N/A"},{key:"medicineName",label:"Medicine",sortable:!0},{key:"disposal",label:"Disposal",sortable:!1,render:(s,t)=>t.disposal?`${t.disposal.genericName}${t.disposal.brandName?` (${t.disposal.brandName})`:""}`:"N/A"},{key:"pickupLocation",label:"Location",sortable:!1,render:s=>e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(j,{className:"w-4 h-4"}),s]})},{key:"preferredTime",label:"Preferred Time",sortable:!0,render:s=>s?new Date(s).toLocaleString():"N/A"},{key:"status",label:"Status",sortable:!0,render:s=>e.jsx("span",{className:`badge badge-${s==="completed"?"success":s==="scheduled"?"info":s==="pending"?"warning":"danger"}`,children:s.toUpperCase()})}],L=s=>{n(s),h(""),b("")},C=async()=>{if(!d){alert("Please select a status");return}try{f(!0),(await F.updateStatus(a.id,{status:d,chwNotes:g})).success&&(alert("Request status updated successfully!"),n(null),i())}catch(s){console.error("Error updating status:",s),alert("Failed to update status. Please try again.")}finally{f(!1)}};return v?e.jsx("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-blue mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading pickup requests..."})]})})}):e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"Pickup Requests"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Review and manage medicine pickup requests"}),x&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg",children:x}),e.jsxs("div",{className:"card mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 flex-wrap",children:[e.jsxs("select",{value:c,onChange:s=>k(s.target.value),className:"input-field flex-1 max-w-xs",children:[e.jsx("option",{value:"all",children:"All Requests"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"scheduled",children:"Scheduled"}),e.jsx("option",{value:"collected",children:"Collected"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsx("div",{className:"mb-4 max-w-xl w-full",children:e.jsx(I,{onSearch:s=>w(s),placeholder:"Search requests by name, medicine or location..."})})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900 dark:bg-opacity-20 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[e.jsx("strong",{children:"Map Placeholder:"})," In production, this would display an interactive map showing pickup locations. To integrate: use Leaflet or Google Maps API with markers for each request location."]})})]}),e.jsx("div",{className:"card",children:e.jsx(A,{columns:R,data:S,actions:s=>e.jsxs("button",{onClick:()=>L(s),className:"btn-outline py-2 px-4 text-sm",children:[e.jsx(P,{className:"w-4 h-4 inline mr-1"}),"Review"]})})}),e.jsx(E,{isOpen:!!a,onClose:()=>n(null),title:"Review Pickup Request",size:"md",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Requester"}),e.jsx("p",{className:"font-medium",children:a.requester?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Medicine"}),e.jsx("p",{className:"font-medium",children:a.disposal?.genericName||a.medicineName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Reason"}),e.jsx("p",{className:"font-medium",children:a.reason?.replace("_"," ")||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Preferred Time"}),e.jsx("p",{className:"font-medium",children:a.preferredTime?new Date(a.preferredTime).toLocaleString():"N/A"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Location"}),e.jsxs("p",{className:"font-medium flex items-center gap-2",children:[e.jsx(j,{className:"w-4 h-4"}),a.pickupLocation]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Disposal Guidance:"}),e.jsx("p",{className:"text-sm",children:a.disposal?.disposalGuidance||a.disposalGuidance||"N/A"})]}),e.jsx(T,{label:"Update Status",id:"reviewStatus",value:d,onChange:s=>h(s.target.value),options:q,placeholder:"Select action"}),e.jsx(M,{label:"Notes (Optional)",id:"reviewNotes",value:g,onChange:s=>b(s.target.value),placeholder:"Add any notes or instructions...",rows:3}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>n(null),className:"btn-outline flex-1",disabled:u,children:"Cancel"}),e.jsx("button",{onClick:C,className:"btn-primary flex-1",disabled:u,children:u?"Submitting...":"Submit"})]})]})})]})}export{X as default};
