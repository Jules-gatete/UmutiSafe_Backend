import{r,j as e,I as v,T as k,G as w,L as m,l as S,y as C}from"./vendor_react-Dd6aiuOH-1761988153571.js";import{S as d}from"./StatCard-CZTiY7cL-1761988153571.js";import{S as R}from"./SearchBar-CyxZkODN-1761988153571.js";import{c as x}from"./index-BNm4ZFjM-1761988153571.js";import"./vendor_misc-i1ZNofER-1761988153571.js";import"./vendor_axios-ngrFHoWO-1761988153571.js";function M(){const[a,u]=r.useState([]),[L,h]=r.useState(null),[p,i]=r.useState(!0),[n,g]=r.useState(""),[l,b]=r.useState("");JSON.parse(localStorage.getItem("user")||"{}"),r.useEffect(()=>{c();const s=setInterval(()=>{c()},1e4),t=()=>{document.hidden||c()};return document.addEventListener("visibilitychange",t),()=>{clearInterval(s),document.removeEventListener("visibilitychange",t)}},[]);const c=async()=>{try{i(!0);const[s,t]=await Promise.all([x.getDashboard(),x.getPickups()]);s.success&&h(s.data),t.success&&u(t.data)}catch(s){console.error("Error fetching dashboard data:",s),g("Failed to load dashboard data")}finally{i(!1)}},j=r.useMemo(()=>{if(!l)return a;const s=l.toLowerCase();return a.filter(t=>(t.userName||"").toLowerCase().includes(s)||(t.pickupLocation||"").toLowerCase().includes(s))},[a,l]),f=a.filter(s=>s.status==="pending"),N=a.filter(s=>s.status==="scheduled"),y=a.filter(s=>s.status==="completed"),o=a.slice(0,5);return p?e.jsx("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-blue mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading dashboard..."})]})})}):e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"CHW Dashboard"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage pickup requests and help your community dispose of medicines safely"})]}),n&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg",children:n}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(d,{icon:v,label:"Pending Requests",value:f.length,color:"yellow"}),e.jsx(d,{icon:k,label:"Scheduled Pickups",value:N.length,color:"blue"}),e.jsx(d,{icon:w,label:"Completed",value:y.length,color:"green"})]}),e.jsx("div",{className:"mb-8 max-w-xl",children:e.jsx(R,{onSearch:s=>b(s),placeholder:"Search pickups by name or address..."})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-text-dark dark:text-text-light",children:"Recent Pickup Requests"}),e.jsx(m,{to:"/chw/pickup-requests",className:"text-sm text-primary-blue dark:text-accent-cta hover:underline font-medium",children:"View All"})]}),o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No pickup requests yet."})]}):e.jsx("div",{className:"space-y-4",children:o.map(s=>e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("h3",{className:"font-semibold text-lg mb-1",children:s.userName}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:s.medicineName}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(C,{className:"w-4 h-4"}),s.pickupLocation]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`badge badge-${s.status==="completed"?"success":s.status==="scheduled"?"info":"warning"}`,children:s.status.toUpperCase()}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.createdAt}),s.status==="pending"&&e.jsx(m,{to:"/chw/pickup-requests",className:"btn-primary py-2 px-4 text-sm",children:"Review"})]})]})},s.id))})]}),e.jsx("div",{children:j.map(s=>e.jsx("div",{className:"card mb-3",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:s.patientName}),e.jsx("div",{className:"text-sm text-gray-600",children:s.address})]}),e.jsx("div",{className:"text-sm",children:s.status})]})},s.id))})]})}export{M as default};
