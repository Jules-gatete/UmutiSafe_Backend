import{a as r,j as e,z as N,v as C,x as D,y as E,$ as I,a0 as A}from"./vendor_react-DOB-gmpH-1761950740192.js";import{I as o}from"./Input-DGHagg2j-1761950740192.js";import{d as L,p as H,a as M}from"./index-D4UIu5-w-1761950740192.js";import"./vendor_misc-B6hkzPCy-1761950740192.js";import"./vendor_axios-ngrFHoWO-1761950740192.js";function O(){const[m,p]=r.useState(!1),[v,u]=r.useState(!0),[x,y]=r.useState(!1),[f,k]=r.useState(""),s=JSON.parse(localStorage.getItem("user")||"{}"),[t,S]=r.useState({name:s.name||"",email:s.email||"",phone:s.phone||"",location:s.location||"",sector:s.sector||""}),[d,j]=r.useState({totalDisposals:0,totalPickups:0,memberSince:s.createdAt||new Date().toISOString()}),[i,w]=r.useState({dataSharing:!0,notifications:!0,locationTracking:!1});r.useEffect(()=>{b();const a=()=>{document.hidden||b()};return document.addEventListener("visibilitychange",a),()=>{document.removeEventListener("visibilitychange",a)}},[]);const b=async()=>{try{u(!0);const[a,l]=await Promise.all([L.getAll(),H.getAll()]);a.success&&j(c=>({...c,totalDisposals:a.data.filter(h=>h.userId===s.id).length})),l.success&&j(c=>({...c,totalPickups:l.data.filter(h=>h.userId===s.id).length}))}catch(a){console.error("Error fetching user data:",a),k("Failed to load user statistics")}finally{u(!1)}},n=a=>{const{name:l,value:c}=a.target;S({...t,[l]:c})},g=a=>{w({...i,[a]:!i[a]})},P=async()=>{try{if(y(!0),(await M.updateProfile(t)).success){const l={...s,...t};localStorage.setItem("user",JSON.stringify(l)),alert("Profile updated successfully!"),p(!1)}}catch(a){console.error("Error updating profile:",a),alert("Failed to update profile. Please try again.")}finally{y(!1)}};return v?e.jsx("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-blue mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading profile..."})]})})}):e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"My Profile"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Manage your account information and settings"}),f&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg",children:f}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-primary-blue text-white flex items-center justify-center font-bold text-3xl mx-auto mb-4",children:s.avatar||s.name?.split(" ").map(a=>a[0]).join("").toUpperCase()}),e.jsx("h2",{className:"text-xl font-bold mb-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:s.role==="user"?"Household User":s.role==="chw"?"Community Health Worker":"Administrator"}),e.jsx("button",{onClick:()=>p(!m),className:"btn-outline w-full",disabled:x,children:m?"Cancel":"Edit Profile"})]}),e.jsxs("div",{className:"lg:col-span-2 card",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Personal Information"}),m?e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{label:"Full Name",id:"name",name:"name",value:t.name,onChange:n}),e.jsx(o,{label:"Email",id:"email",name:"email",type:"email",value:t.email,onChange:n}),e.jsx(o,{label:"Phone",id:"phone",name:"phone",type:"tel",value:t.phone,onChange:n}),e.jsx(o,{label:"Location",id:"location",name:"location",value:t.location,onChange:n}),s.role==="user"&&e.jsx(o,{label:"Sector",id:"sector",name:"sector",value:t.sector,onChange:n,icon:N}),e.jsx("button",{onClick:P,className:"btn-primary w-full",disabled:x,children:x?"Saving...":"Save Changes"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Email"}),e.jsx("p",{className:"font-medium",children:t.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Phone"}),e.jsx("p",{className:"font-medium",children:t.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Location"}),e.jsx("p",{className:"font-medium",children:t.location||"Not specified"})]})]}),s.role==="user"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Sector"}),e.jsx("p",{className:"font-medium",children:t.sector||"Not specified"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Member Since"}),e.jsx("p",{className:"font-medium",children:new Date(d.memberSince).toLocaleDateString()})]})]})]})]})]}),e.jsxs("div",{className:"card mb-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Activity Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-primary-blue dark:text-accent-cta mb-1",children:d.totalDisposals}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total Disposals"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-primary-green mb-1",children:d.totalPickups}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"CHW Pickups"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-3xl font-bold text-accent-cta mb-1",children:Math.floor((Date.now()-new Date(d.memberSince).getTime())/(1e3*60*60*24*30))}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Months Active"})]})]})]}),e.jsxs("div",{className:"card mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Privacy & Consent"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data Sharing with CHWs"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Allow CHWs to access your disposal history for better service"})]}),e.jsx("input",{type:"checkbox",checked:i.dataSharing,onChange:()=>g("dataSharing"),className:"w-12 h-6 rounded-full appearance-none bg-gray-300 dark:bg-gray-600 relative cursor-pointer transition-colors checked:bg-primary-green"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Notifications"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Receive updates about pickups and safety alerts"})]}),e.jsx("input",{type:"checkbox",checked:i.notifications,onChange:()=>g("notifications"),className:"w-12 h-6 rounded-full appearance-none bg-gray-300 dark:bg-gray-600 relative cursor-pointer transition-colors checked:bg-primary-green"})]}),e.jsxs("label",{className:"flex items-center justify-between cursor-pointer p-3 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Location Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Help CHWs find you for faster pickups"})]}),e.jsx("input",{type:"checkbox",checked:i.locationTracking,onChange:()=>g("locationTracking"),className:"w-12 h-6 rounded-full appearance-none bg-gray-300 dark:bg-gray-600 relative cursor-pointer transition-colors checked:bg-primary-green"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Account Actions"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-outline w-full text-left",children:"Change Password"}),e.jsx("button",{className:"btn-outline w-full text-left text-warning hover:bg-red-50 dark:hover:bg-red-900 dark:hover:bg-opacity-20",children:"Logout"})]})]})]})}export{O as default};
