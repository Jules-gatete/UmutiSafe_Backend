import{r,u as T,V as _,j as e,W as F,X as E,T as H}from"./vendor_react-CK1M0B1O-1761988251229.js";import{T as I}from"./Table-p0UcKWoY-1761988251229.js";import{M}from"./Modal-D3WPayf--1761988251229.js";import{d as G}from"./index-BPH-ltX_-1761988251229.js";import"./vendor_misc-i1ZNofER-1761988251229.js";import"./vendor_axios-ngrFHoWO-1761988251229.js";function X(){const[t,p]=r.useState(null),[o,m]=r.useState("all"),[y,u]=r.useState(!1),[i,n]=r.useState(1),[l,w]=r.useState(10),[x,h]=r.useState([]),[S,N]=r.useState(!0),[j,R]=r.useState(""),[b,k]=r.useState(""),D=T();r.useEffect(()=>{d();const a=new URLSearchParams(window.location.search).get("filter");a&&f(a==="highRisk"?"highRisk":a);const P=setInterval(()=>{d()},1e4),v=()=>{document.hidden||d()};return document.addEventListener("visibilitychange",v),()=>{clearInterval(P),document.removeEventListener("visibilitychange",v)}},[]);const d=async()=>{try{N(!0),k("");const s=await G.getAll();if(s&&s.success)h(s.data);else{const a=s?.error?.message||s?.error||"Failed to load disposals from server";k(a),h([])}}catch(s){console.error("Error fetching disposals:",s),R("Failed to load disposal history")}finally{N(!1)}},C=s=>{const a={medicineName:s.genericName||s.generic_name||"",disposalGuidance:s.disposalGuidance||s.disposal_guidance||s.safetyNotes||"",disposalId:s.id||s._id||null};D("/user/chw-interaction",{state:a})},c=y?x.filter(s=>s.riskLevel==="HIGH"):o==="all"?x:x.filter(s=>s.status===o),A=c.length,g=Math.max(1,Math.ceil(A/l)),L=_.useMemo(()=>{const s=(i-1)*l;return c.slice(s,s+l)},[c,i,l]),f=s=>{n(1),s==="highRisk"?(u(!0),m("all")):(u(!1),m(s))},q=[{key:"genericName",label:"Medicine",sortable:!0,render:(s,a)=>e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s}),a.brandName&&e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.brandName})]})},{key:"dosageForm",label:"Form",sortable:!0,render:s=>e.jsx("span",{className:"text-sm",children:s||"N/A"})},{key:"riskLevel",label:"Risk",sortable:!0,render:s=>e.jsx("span",{className:`badge badge-${s==="HIGH"?"danger":s==="MEDIUM"?"warning":"success"}`,children:s})},{key:"status",label:"Status",sortable:!0,render:s=>e.jsx("span",{className:`badge badge-${s==="completed"?"success":s==="pending_review"?"warning":s==="pickup_requested"?"info":"secondary"}`,children:s.replace("_"," ").toUpperCase()})},{key:"createdAt",label:"Date",sortable:!0,render:s=>{const a=new Date(s);return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.toLocaleDateString()}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})}}];return S?e.jsx("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-blue mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading disposal history..."})]})})}):e.jsxs("div",{className:"p-4 lg:p-8 pb-24 lg:pb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-dark dark:text-text-light mb-2",children:"Disposal History"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"View all your past medicine disposals and track their status"})]}),j&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg",children:j}),e.jsx("div",{className:"card mb-6",children:e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(F,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"}),e.jsxs("select",{value:o,onChange:s=>m(s.target.value),className:"input-field flex-1 max-w-xs",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"pending_review",children:"Pending Review"}),e.jsx("option",{value:"pickup_requested",children:"Pickup Requested"})]}),e.jsx("button",{onClick:d,className:"btn-outline ml-auto",children:"Refresh"})]})}),b&&e.jsx("div",{className:"mb-4 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded-lg",children:b}),e.jsx("div",{className:"card",children:c.length===0?e.jsx("div",{className:"p-6 text-center text-gray-600 dark:text-gray-400",children:"No disposal records found."}):e.jsxs(e.Fragment,{children:[e.jsx(I,{columns:q,data:L,actions:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>p(s),className:"btn-outline py-2 px-4 text-sm",children:[e.jsx(E,{className:"w-4 h-4 inline mr-1"}),"View"]}),s.status==="pending_review"&&!s.pickupRequest&&e.jsxs("button",{onClick:()=>C(s),className:"btn-primary py-2 px-4 text-sm flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"Request Pickup"]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-outline px-3 py-1",onClick:()=>n(s=>Math.max(1,s-1)),disabled:i===1,children:"Prev"}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",i," of ",g]}),e.jsx("button",{className:"btn-outline px-3 py-1",onClick:()=>n(s=>Math.min(g,s+1)),disabled:i===g,children:"Next"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Rows:"}),e.jsxs("select",{value:l,onChange:s=>{w(Number(s.target.value)),n(1)},className:"input-field",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"})]})]})]})]})}),e.jsx(M,{isOpen:!!t,onClose:()=>p(null),title:"Disposal Details",size:"lg",children:t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg mb-2",children:[t.genericName,t.brandName&&` (${t.brandName})`]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("span",{className:`badge badge-${t.riskLevel==="HIGH"?"danger":t.riskLevel==="MEDIUM"?"warning":"success"}`,children:[t.riskLevel," Risk"]}),e.jsx("span",{className:"badge badge-info",children:t.predictedCategory||"N/A"}),e.jsx("span",{className:`badge badge-${t.status==="completed"?"success":t.status==="pending_review"?"warning":t.status==="pickup_requested"?"info":"secondary"}`,children:t.status.replace("_"," ").toUpperCase()})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Dosage Form"}),e.jsx("p",{className:"font-medium",children:t.dosageForm||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Packaging"}),e.jsx("p",{className:"font-medium",children:t.packagingType||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Submitted"}),e.jsxs("p",{className:"font-medium",children:[new Date(t.createdAt).toLocaleDateString()," ",new Date(t.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Reason"}),e.jsx("p",{className:"font-medium",children:t.reason?.replace("_"," ")||"N/A"})]}),t.completedAt&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed At"}),e.jsxs("p",{className:"font-medium",children:[new Date(t.completedAt).toLocaleDateString()," ",new Date(t.completedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900 dark:bg-opacity-20 rounded-lg p-4 border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-semibold mb-2 text-blue-900 dark:text-blue-100",children:"Disposal Guidance:"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:t.disposalGuidance||"No guidance available"})]}),t.confidence&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Classification Confidence"}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full ${t.confidence>=.8?"bg-green-500":t.confidence>=.6?"bg-yellow-500":"bg-orange-500"}`,style:{width:`${t.confidence*100}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:[(t.confidence*100).toFixed(1),"% confident"]})]}),t.pickupRequest&&e.jsxs("div",{className:"bg-green-50 dark:bg-green-900 dark:bg-opacity-20 rounded-lg p-4 border border-green-200 dark:border-green-800",children:[e.jsx("h4",{className:"font-semibold mb-3 text-green-900 dark:text-green-100",children:"Pickup Request Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"CHW Assigned"}),e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:t.pickupRequest.chw?.name||"Not assigned"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"CHW Phone"}),e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:t.pickupRequest.chw?.phone||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Pickup Status"}),e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:t.pickupRequest.status?.replace("_"," ").toUpperCase()||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Pickup Location"}),e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:t.pickupRequest.pickupLocation||"N/A"})]}),t.pickupRequest.scheduledTime&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Scheduled Time"}),e.jsxs("p",{className:"font-medium text-green-900 dark:text-green-100",children:[new Date(t.pickupRequest.scheduledTime).toLocaleDateString()," ",new Date(t.pickupRequest.scheduledTime).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),t.pickupRequest.chwNotes&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"CHW Notes"}),e.jsx("p",{className:"font-medium text-green-900 dark:text-green-100",children:t.pickupRequest.chwNotes})]})]})]}),t.notes&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Additional Notes:"}),e.jsx("p",{className:"text-sm",children:t.notes})]})]})})]})}export{X as default};
